plugins {
    id "com.android.library"
    id "kotlin-android"
    id "kotlin-kapt"
}

android {
    buildFeatures {
        buildConfig = true
        viewBinding = true
    }

    compileSdkVersion buildConfig.compileSdk
    buildToolsVersion buildConfig.buildTools

    defaultConfig {
        minSdkVersion buildConfig.minSdk
        targetSdkVersion buildConfig.targetSdk
        versionCode releaseConfig.versionCode
        versionName releaseConfig.version

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        javaCompileOptions {
            annotationProcessorOptions {
                arguments += [
                    "room.incremental": "true",
                ]
            }
        }
    }

    buildTypes {
        debug {
            testCoverageEnabled true
            debuggable true
            minifyEnabled false
        }
        release {
            debuggable false
            minifyEnabled true
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.txt"
        }
    }

    resourcePrefix 'collar_'

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8.toString()
        freeCompilerArgs += [
                '-Xopt-in=org.koin.core.component.KoinApiExtension',
                '-Xexplicit-api=strict'
        ]
    }
    packagingOptions {
        exclude 'META-INF/DEPENDENCIES'
        exclude 'META-INF/LICENSE'
        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/license.txt'
        exclude 'META-INF/NOTICE'
        exclude 'META-INF/NOTICE.txt'
        exclude 'META-INF/notice.txt'
        exclude 'META-INF/ASL2.0'
        exclude("META-INF/*.kotlin_module")
    }
    testOptions {
        animationsDisabled = true
    }

    sourceSets.each {
        it.java.srcDirs += "src/$it.name/kotlin"
    }
}

dependencies {
    implementation packages.kotlin.core
    implementation packages.kotlinx.coroutines
    api packages.collar.core
    implementation packages.androidx.appcompat
    implementation packages.androidx.core
    implementation packages.androidx.recyclerview
    implementation packages.androidx.lifecycle.livedata
    implementation packages.androidx.lifecycle.viewmodel
    implementation packages.androidx.startup
    implementation packages.androidx.room.runtime
    implementation packages.androidx.room.ktx
    kapt packages.androidx.room.compiler
    implementation packages.google.design
    implementation packages.koin.android
    implementation packages.koin.scope
    implementation packages.koin.viewmodel
    implementation packages.timber.core

    testImplementation "junit:junit:4.13"
    testImplementation 'org.mockito:mockito-core:3.5.7'

    androidTestImplementation 'androidx.arch.core:core-testing:2.1.0'
    androidTestImplementation 'androidx.test.ext:junit:1.1.2'
    androidTestImplementation 'androidx.test:core-ktx:1.3.0'
    androidTestImplementation 'org.mockito:mockito-android:3.3.3'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.3.0'
    androidTestImplementation 'androidx.test.espresso:espresso-intents:3.3.0'
//    testImplementation 'androidx.test.espresso:espresso-core:3.3.0'
//    testImplementation 'androidx.test.espresso:espresso-intents:3.3.0'
}

apply from: "publish.gradle"

project.gradle.taskGraph.whenReady {
    connectedDebugAndroidTest {
        ignoreFailures = true
    }
}